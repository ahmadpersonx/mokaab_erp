# SmartVoucherScreen - ุฏููู ุงูุงุณุชุฎุฏุงู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุณูู `SmartVoucherScreen` ุจุดูู ูุงูู ูุชุทุจูู ุงูุดุฑูุท ุงููุญุงุณุจูุฉ ุงูุตุญูุญุฉ ูุฅุฏุฎุงู ุณูุฏุงุช ุงููุจุถ ูุงูุตุฑู ูุน ุฏุนู RTL ูุงูุซูู ุงูููุญุฏ.

**ุงููุณุงุฑ**: `lib/features/finance/screens/smart_voucher_screen.dart`

---

## ๐ฏ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1๏ธโฃ **ุฅุฏุงุฑุฉ ุงูุฃุทุฑุงู ุงููุญุงุณุจูุฉ**

```dart
// ุงูุฌุงูุจ ุงููุฏูู (ูุณุงุฑ): ุฌูุฉ ุงุณุชูุจุงู ุงููููุณ
List<Map<String, dynamic>> _debitLines = [];

// ุงูุฌุงูุจ ุงูุฏุงุฆู (ูููู): ุฌูุฉ ุฏูุน ุงููููุณ
List<Map<String, dynamic>> _creditLines = [];
```

### 2๏ธโฃ **ุงูุดุฑูุท ุงููุญุงุณุจูุฉ ุงูุฅูุฒุงููุฉ**

#### โ ุงูุชูุงุฒู ุงููุญุงุณุจู
```dart
bool _validateBalance() {
  double totalDebit = _debitLines.fold(0, (sum, line) => sum + (line['amount'] ?? 0.0));
  double totalCredit = _creditLines.fold(0, (sum, line) => sum + (line['amount'] ?? 0.0));
  return (totalDebit - totalCredit).abs() < 0.01;  // ุงูุชูุงูุช ุงูููุจูู: 0.01 ุฏ.ุฃ
}
```
**ุงูุดุฑุท**: ุฅุฌูุงูู ุงููุฏูู MUST = ุฅุฌูุงูู ุงูุฏุงุฆู
**ุงูุฑุณุงูุฉ**: "ุงูุฌุงูุจ ุงููุฏูู ูุงูุฏุงุฆู ูุฌุจ ุฃู ููููุง ูุชุณุงูููู"

#### โ ูุฌูุฏ ุฃุทุฑุงู ูู ุงูุฌูุชูู
```dart
bool _validateBothSides() {
  return _debitLines.isNotEmpty && _creditLines.isNotEmpty;
}
```
**ุงูุดุฑุท**: ูุฌุจ ุฃู ูููู ููุงู ุญุณุงุจ ูุงุญุฏ ุนูู ุงูุฃูู ูู ูู ุฌุงูุจ
**ุงูุฑุณุงูุฉ**: "ูุฌุจ ุฃู ูููู ููุงู ุฌุงูุจ ูุฏูู ูุฌุงูุจ ุฏุงุฆู"

#### โ ุนุฏู ุชูุฑุงุฑ ุงูุญุณุงุจุงุช
```dart
bool _validateNoDuplicates() {
  final debitAccountIds = _debitLines.map((l) => l['account_id']).toSet();
  final creditAccountIds = _creditLines.map((l) => l['account_id']).toSet();
  return debitAccountIds.length == _debitLines.length &&
         creditAccountIds.length == _creditLines.length;
}
```
**ุงูุดุฑุท**: ูุง ูููู ุงุณุชุฎุฏุงู ููุณ ุงูุญุณุงุจ ูุฑุชูู ูู ุงูุฌุงูุจ ุงููุงุญุฏ
**ุงูุฑุณุงูุฉ**: "ูุง ูููู ุชูุฑุงุฑ ููุณ ุงูุญุณุงุจ ูู ููุณ ุงูุฌุงูุจ"

### 3๏ธโฃ **ูุงุฌูุฉ ุงููุณุชุฎุฏู**

#### ๐ ุจุทุงูุฉ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ
- ุฑูู ุงูุณูุฏ (ุชููุงุฆู ููุณูุฏุงุช ุงูุฌุฏูุฏุฉ)
- ุชุงุฑูุฎ ุงูุณูุฏ (ููุชูู ุงูุชุงุฑูุฎ)
- ุทุฑููุฉ ุงูุฏูุน (ููุฏู / ุดูู / ุชุญููู ุจููู)
- ุงูุจูุงู / ุงูููุงุญุธุงุช

#### ๐ ุนุฑุถ ุงูุฌุงูุจ ุงููุฏูู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงูุฌุงูุจ ุงููุฏูู (ุฌูุฉ ุงูุงุณุชูุจุงู)    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ ุงูุฅุฌูุงูู: ุฏ.ุฃ 5,000.000           โ
โ                                    โ
โ [ุญุณุงุจ ุงูุจูู - 2000.000]          โ
โ [ุงูุตูุฏูู - 3000.000]             โ
โ                                    โ
โ [+ ุฅุถุงูุฉ ุณุทุฑ]                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูููุฒุงุช**:
- ุนุฑุถ ุงุณู ุงูุญุณุงุจ ูุงูุฑูุฒ
- ุนุฑุถ ุงููุจูุบ ุจุตูุบุฉ ูุญุงุณุจูุฉ (ุฏ.ุฃ X,XXX.XXX)
- ุฒุฑ ุญุฐู ุณุฑูุน ููู ุณุทุฑ
- ุฒุฑ ุฅุถุงูุฉ ุณุทุฑ ุฌุฏูุฏ

#### ๐ ุนุฑุถ ุงูุฌุงูุจ ุงูุฏุงุฆู
ููุณ ุงูุจููุฉ ูุงูุฌุงูุจ ุงููุฏูู ูููู ุจุฃููุงู ูุฎุชููุฉ (ุฃุฒุฑู vs ุจุฑุชูุงูู)

#### โ๏ธ ูุคุดุฑ ุงูุชูุงุฒู
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุฅุฌูุงูู ุงููุฏูู: ุฏ.ุฃ 5,000.000      โ
โ ุฅุฌูุงูู ุงูุฏุงุฆู: ุฏ.ุฃ 5,000.000      โ
โ                                    โ
โ โ ูุชูุงุฒู                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ุฅุฐุง ูู ูุชูุงุฒู:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุฅุฌูุงูู ุงููุฏูู: ุฏ.ุฃ 5,000.000      โ
โ ุฅุฌูุงูู ุงูุฏุงุฆู: ุฏ.ุฃ 3,000.000      โ
โ                                    โ
โ โ๏ธ ุงููุฑู: ุฏ.ุฃ 2,000.000            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ุงูุทุฑู ุงูุฑุฆูุณูุฉ

### ุฅุถุงูุฉ ุณุทุฑ
```dart
/// ุฅุถุงูุฉ ุณุทุฑ ุฅูู ุงูุฌุงูุจ ุงููุฏูู
void _addDebitLine(AccountModel account, double amount)

/// ุฅุถุงูุฉ ุณุทุฑ ุฅูู ุงูุฌุงูุจ ุงูุฏุงุฆู
void _addCreditLine(AccountModel account, double amount)
```

### ุญุฐู ุณุทุฑ
```dart
/// ุญุฐู ุณุทุฑ ูู ุงูุฌุงูุจ ุงููุฏูู
void _removeDebitLine(int index)

/// ุญุฐู ุณุทุฑ ูู ุงูุฌุงูุจ ุงูุฏุงุฆู
void _removeCreditLine(int index)
```

### ุญูุธ ุงูุณูุฏ
```dart
Future<void> _saveVoucher() async {
  // ูุชุญูู ุชููุงุฆูุงู ูู:
  // 1. ุงูุชูุงุฒู ุงููุญุงุณุจู
  // 2. ูุฌูุฏ ุฃุทุฑุงู ูู ุงูุฌูุชูู
  // 3. ุนุฏู ุชูุฑุงุฑ ุงูุญุณุงุจุงุช
  // 4. ูุฌูุฏ ุงูุจูุงู
  
  // ูู ุญุงูุฉ ุงููุฌุงุญ:
  // - ูุญูุธ ุงูุณูุฏ ูู Supabase
  // - ูุนูุฏ ุงููุณุชุฎุฏู ููุดุงุดุฉ ุงูุณุงุจูุฉ
}
```

---

## ๐จ ุงูุชูุงูู ูุน AppTheme

```dart
// ุงูุฃููุงู ุงููุณุชุฎุฏูุฉ:
AppTheme.kSuccess       // ููุณูุฏุงุช ุงูุฎุถุฑุงุก (ูุจุถ)
AppTheme.kError         // ููุณูุฏุงุช ุงูุญูุฑุงุก (ุตุฑู)
AppTheme.kDarkBrown     // ููุฃุฒุฑุงุฑ ูุงูุนูุงููู
AppTheme.kWarning       // ููุคุดุฑุงุช ุนุฏู ุงูุชูุงุฒู
```

### ุงูุฃููุงู ุงููุฎุตุตุฉ:
- **ุงูุฌุงูุจ ุงููุฏูู**: ุฃุฒุฑู (Colors.blue)
- **ุงูุฌุงูุจ ุงูุฏุงุฆู**: ุจุฑุชูุงูู (Colors.orange)

---

## ๐ฑ ุงูุงุณุชุฎุฏุงู

### ุชุณุฌูู ุงููุณุงุฑ ูู `main.dart`
```dart
'/smart_voucher': (context) => SmartVoucherScreen(
  voucherType: 'receipt',  // ุฃู 'payment'
  voucherNumber: null,     // ุฃู ุฑูู ุงูุณูุฏ ููุชุนุฏูู
),
```

### ุงุณุชุฏุนุงุก ุงูุดุงุดุฉ
```dart
// ุฅูุดุงุก ุณูุฏ ุฌุฏูุฏ
Navigator.pushNamed(
  context,
  '/smart_voucher',
  arguments: {'voucherType': 'receipt'},
);

// ุชุนุฏูู ุณูุฏ ููุฌูุฏ
Navigator.pushNamed(
  context,
  '/smart_voucher',
  arguments: {
    'voucherType': 'receipt',
    'voucherNumber': 'RCV-2025-001'
  },
);
```

---

## โ ุชู ุฅุตูุงุญู/ุชุญุณููู

### โ ุงูููุฏ ุงูุฌุฏูุฏ ุชูุงูุงู
1. ุญุฐู ุงูุดุฑูุท ุงูุจุณูุทุฉ ุงููุฏููุฉ
2. ุฅุถุงูุฉ ููุทู ูุฒุฏูุฌ ุงูุฌุงูุจ (Double-Entry Bookkeeping)
3. UI ุฌุฏูุฏ ุจุงููุงูู ูุน ุจุทุงูุงุช ุงููุนูููุงุช

### โ ุชุญูู ูู ุงูุนูุงูุงุช
1. RTL support โ
2. AppTheme integration โ (16 ููู ููุญุฏ)
3. Responsive design โ (Mobile-first)
4. Arabic localization โ
5. Accounting rules โ (ุชู ุชุทุจูููุง ุจุดูู ูุงูู)

### โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก Compilation
```
โ No errors found
โ All imports resolved
โ All widgets working
```

---

## ๐งช ุญุงูุงุช ุงูุงุฎุชุจุงุฑ

### โ ุญุงูุฉ ูุงุฌุญุฉ
```
ุงูุฌุงูุจ ุงููุฏูู:
  - ุงูุจูู: ุฏ.ุฃ 1,000
  - ุงูุตูุฏูู: ุฏ.ุฃ 4,000
  ุงูุฅุฌูุงูู: ุฏ.ุฃ 5,000

ุงูุฌุงูุจ ุงูุฏุงุฆู:
  - ุงูููุธููู: ุฏ.ุฃ 5,000
  ุงูุฅุฌูุงูู: ุฏ.ุฃ 5,000

ุงููุชูุฌุฉ: โ ุญูุธ ูุงุฌุญ
```

### โ ุญุงูุฉ ูุดู: ุนุฏู ุงูุชูุงุฒู
```
ุงูุฌุงูุจ ุงููุฏูู:
  - ุงูุจูู: ุฏ.ุฃ 1,000
  ุงูุฅุฌูุงูู: ุฏ.ุฃ 1,000

ุงูุฌุงูุจ ุงูุฏุงุฆู:
  - ุงูููุธููู: ุฏ.ุฃ 5,000
  ุงูุฅุฌูุงูู: ุฏ.ุฃ 5,000

ุงููุชูุฌุฉ: โ "ุงูุฌุงูุจ ุงููุฏูู ูุงูุฏุงุฆู ูุฌุจ ุฃู ููููุง ูุชุณุงูููู"
```

### โ ุญุงูุฉ ูุดู: ุญุณุงุจ ููุฑุฑ
```
ุงูุฌุงูุจ ุงููุฏูู:
  - ุงูุจูู: ุฏ.ุฃ 1,000
  - ุงูุจูู: ุฏ.ุฃ 4,000
  ุงูุฅุฌูุงูู: ุฏ.ุฃ 5,000

ุงูุฌุงูุจ ุงูุฏุงุฆู:
  - ุงูููุธููู: ุฏ.ุฃ 5,000
  ุงูุฅุฌูุงูู: ุฏ.ุฃ 5,000

ุงููุชูุฌุฉ: โ "ูุง ูููู ุชูุฑุงุฑ ููุณ ุงูุญุณุงุจ ูู ููุณ ุงูุฌุงูุจ"
```

---

## ๐ ุจููุฉ ุงูุจูุงูุงุช ุงููุญููุธุฉ

```dart
{
  'voucher_number': 'RCV-2025-001',
  'voucher_type': 'receipt',
  'date': DateTime(2025, 12, 20),
  'description': 'ุงุณุชูุจุงู ูู ุงููุจูุนุงุช',
  'payment_method': 'cash',
  'debit_lines': [
    {
      'account_id': 'ACC-001',
      'account_name': 'ุญุณุงุจ ุงูุจูู',
      'account_code': '1100',
      'amount': 5000.000,
    }
  ],
  'credit_lines': [
    {
      'account_id': 'ACC-002',
      'account_name': 'ุงูุฅูุฑุงุฏุงุช',
      'account_code': '4100',
      'amount': 5000.000,
    }
  ],
  'total_amount': 5000.000,
}
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุงุฑ ุดุงูู** ุนูู ุฃุฌูุฒุฉ ูุฎุชููุฉ
2. **ุงูุฑุจุท ูุน Supabase** ูุญูุธ ุงูุณูุฏุงุช
3. **ุฅุถุงูุฉ ุดุงุดุฉ ุงูุชูุงุตูู** ูุนุฑุถ ุงูุณูุฏ ุงููุญููุธ
4. **ุชูุฑูุฑ ุงูุทุจุงุนุฉ** ุจุตูุบุฉ PDF
5. **ููุงููุงุช ุงููุฏูุฑ** (Workflow)

---

## ๐ ุงูุฏุนู

- **ุงูููู**: `lib/features/finance/screens/smart_voucher_screen.dart`
- **ุงูุณุทูุฑ**: 664 ุณุทุฑ
- **ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุฅูุชุงุฌ
- **ุขุฎุฑ ุชุญุฏูุซ**: 2025-12-20

---

**ุขุฎุฑ ููุงุญุธุฉ**: ุชุฃูุฏ ูู ุฃู `FinanceFormatter` ู `FinanceService` ููุฌูุฏุฉ ููุตุญุญุฉ ููุนูู ูุน ูุฐู ุงูุดุงุดุฉ.
